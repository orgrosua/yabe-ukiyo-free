import{l as M,m as O,E as j,e as c,x as R,f as G,G as H,K as I,D as n,L as X,r as W,z as J,o as p,c as k,b as e,t as i,u as s,h as C,a as y,d as w,A as $,F as A,n as d,k as Q,H as Z,g as E,w as N}from"./app-DmP38fiz.js";import{d as ee}from"./debounce-XxfNuXcX.js";import{b as te,a as ae,u as se}from"./notifier-oDSeFarO.js";import{u as ne,a as oe,o as le}from"./switch-DdjbC4Z_.js";import"./isObjectLike-mqpIr8Ea.js";import"./isSymbol-BpHlYMiq.js";const ie={class:"mr:8 font:24"},re={class:"form-table",role:"presentation"},ue={scope:"row"},ce={class:"flex"},de=e("span",{class:"text"},"Paste Token",-1),fe=e("p",{class:"description"}," Paste the Token produced by Yabe Ukiyo to fill the below fields automatically. ",-1),me={scope:"row"},ve=e("span",{class:"fg:red-35"},"*",-1),pe={scope:"row"},ye=e("span",{class:"fg:red-35"},"*",-1),ge={key:0,class:"description"},be={key:0},_e={class:"font:semibold"},he=e("br",null,null,-1),ke=e("span",{class:"font:semibold"},"Bricks: ",-1),we=e("br",null,null,-1),xe=e("span",{class:"font:semibold"},"Yabe Ukiyo: ",-1),De={scope:"row"},Se=e("span",{class:"fg:red-35"},"*",-1),Be={class:"flex"},Ce={class:"rel flex mr:8 align-items:center"},Te=["type"],Ue=e("p",{class:"description"},null,-1),Ve={scope:"row"},Ne={class:"flex align-items:center"},Fe=["disabled"],Ye={__name:"Edit",props:{showSaveButton:{type:Boolean}},setup(qe){const x=te(),P=M(),F=O(),D=ae(),f=se(),S=j(),m=c({}),T=c(!1),B=c(!0),g=c(""),b=c(""),r=c(!0),v=c(""),q=c(null),U={status:null,connected:!1,yabeUkiyoDetected:!1,bricksDetected:!1},o=c({...U});R(v,ee((a,t)=>{if(a!==t&&(o.value={...U},a!==""&&q.value.checkValidity())){o.value.status="loading";const u=new URL(a.trim().replace(/\/$/,""));x.request({method:"POST",url:"/admin/settings/central_management/check-connection",data:{url:u.origin}}).then(h=>{h.status===200?(o.value={...o.value,status:!0,connected:!0},o.value.yabeUkiyoDetected=h.data.namespaces.find(l=>l==="yabe-ukiyo/v1")!==void 0,o.value.bricksDetected=h.data.namespaces.find(l=>l==="bricks/v1")!==void 0):o.value.status=!1}).catch(h=>{o.value={...U,status:!1}})}},100));async function z(){return f.add("settings.central_management.edit:fetch-item"),x.request({method:"GET",url:`/admin/settings/central_management/detail/${P.params.id}`}).then(a=>a.data).then(a=>{g.value=a.secret_key,b.value=a.title,r.value=a.status,v.value=a.url,m.value=a}).finally(()=>{f.remove("settings.central_management.edit:fetch-item")})}function Y(a){a.preventDefault(),f.add("settings.central_management.edit:send-form");let t=x.request({method:"POST",url:`/admin/settings/central_management/update/${m.value.id}`,data:{title:b.value,secret_key:g.value,status:r.value,url:v.value}}).then(u=>{S.add({type:"success",message:"<p>Site updated successfully.</p>"}),z()}).finally(()=>{f.remove("settings.central_management.edit:send-form")});D.async(t,"Site updated successfully.",void 0,"Updating site...")}function K(){confirm(n("Are you sure you want to delete the site?","yabe-ukiyo"))&&(T.value=!0,f.add("settings.central_management.edit:delete"),x.request({method:"POST",url:`/admin/settings/central_management/delete/${m.value.id}`}).then(a=>{F.push({name:"settings.central_management.index"})}).catch(function(a){D.alert(a.message)}).finally(()=>{T.value=!1,f.remove("settings.central_management.edit:delete")}))}function L(){navigator.clipboard.readText().then(a=>{try{const t=atob(a).split(`
`);t.length===3&&(v.value=t[0],b.value=t[1],g.value=t[2])}catch{}})}const V=G(()=>m.value?m.value.secret_key!==g.value||m.value.title!==b.value||m.value.status!==r.value||m.value.url!==v.value:!1),_=c(null);return R(V,(a,t)=>{a&&!_.value?_.value=S.add({type:"warning",message:"<p>You have unsaved changes.</p>"}):(S.remove(_.value),_.value=null)}),H(()=>{let a=z();D.async(a,"Site details loaded.",t=>{D.alert(t.response&&t.response.status===404?"Site not found.":"Failed to load site details."),F.go(-1)},"Fetching site details...")}),I((a,t,u)=>{V.value&&!confirm(n("You have unsaved changes. Are you sure you want to leave?","yabe-ukiyo"))||u()}),window.onbeforeunload=function(a){if(V.value)return n("You have unsaved changes. Are you sure you want to leave?","yabe-ukiyo")},X(()=>{window.onbeforeunload=null,_.value&&S.remove(_.value)}),(a,t)=>{const u=W("font-awesome-icon"),h=J("ripple");return p(),k(A,null,[e("span",ie,"Â» "+i(s(n)("Edit","yabe-ukiyo")),1),e("form",{onSubmit:Y},[e("div",null,[e("table",re,[e("tbody",null,[e("tr",null,[e("th",ue,[e("label",null,i(s(n)("Token","yabe-ukiyo")),1)]),e("td",null,[e("div",ce,[C((p(),k("div",{onClick:t[0]||(t[0]=l=>L()),class:"button flex align-items:center"},[y(u,{icon:["fas","paste"],class:"font:15 mr:6"}),de])),[[h]])]),fe])]),e("tr",null,[e("th",me,[e("label",null,[w(i(s(n)("Title","yabe-ukiyo"))+" ",1),ve])]),e("td",null,[C(e("input",{type:"text",name:"title","onUpdate:modelValue":t[1]||(t[1]=l=>b.value=l),required:""},null,512),[[$,b.value,void 0,{trim:!0,lazy:!0}]])])]),e("tr",null,[e("th",pe,[e("label",null,[w(i(s(n)("Site URL","yabe-ukiyo"))+" ",1),ye])]),e("td",null,[C(e("input",{type:"url",ref_key:"urlField",ref:q,name:"url","onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l),required:""},null,512),[[$,v.value,void 0,{trim:!0,lazy:!0}]]),o.value.status!==null?(p(),k("p",ge,[o.value.status==="loading"?(p(),k("span",be,[y(u,{icon:["fas","spinner"],class:"mr:4 fg:gray-60 animation:rotate|linear|1s|infinite"}),w(" "+i(s(n)("Connecting","yabe-ukiyo"))+"... ",1)])):(p(),k(A,{key:1},[e("span",_e,i(s(n)("Server","yabe-ukiyo"))+": ",1),e("span",{class:d(o.value.connected?"fg:green-50":"fg:red-40")},i(o.value.connected?s(n)("Connected","yabe-ukiyo"):s(n)("Failed to connect","yabe-ukiyo")),3),he,ke,e("span",{class:d(o.value.bricksDetected?"fg:green-50":"fg:red-40")},i(o.value.bricksDetected?s(n)("Detected","yabe-ukiyo"):s(n)("Not detected","yabe-ukiyo")),3),we,xe,e("span",{class:d(o.value.yabeUkiyoDetected?"fg:green-50":"fg:yellow-60")},i(o.value.yabeUkiyoDetected?s(n)("Detected","yabe-ukiyo"):s(n)("Not detected","yabe-ukiyo")),3)],64))])):Q("",!0)])]),e("tr",null,[e("th",De,[e("label",null,[w(i(s(n)("Secret Key","yabe-ukiyo"))+" ",1),Se])]),e("td",null,[e("div",Be,[e("div",Ce,[C(e("input",{type:B.value?"text":"password",name:"secret_key","onUpdate:modelValue":t[3]||(t[3]=l=>g.value=l),autocomplete:"current-password",class:"min-w:300 hide::-ms-reveal"},null,8,Te),[[Z,g.value]]),e("span",{onClick:t[4]||(t[4]=l=>B.value=!B.value),class:"flex align-items:center ml:-24 fg:gray-60 fg:gray-40:hover cursor:pointer"},[B.value?(p(),E(u,{key:1,icon:["fas","eye-slash"],class:"font:15"})):(p(),E(u,{key:0,icon:["fas","eye"],class:"font:15"}))])])]),Ue])]),e("tr",null,[e("th",Ve,[e("label",null,i(s(n)("Status","yabe-ukiyo")),1)]),e("td",null,[y(s(le),{as:"div",class:"flex align-items:center"},{default:N(()=>[y(s(ne),{modelValue:r.value,"onUpdate:modelValue":t[5]||(t[5]=l=>r.value=l),class:d([[r.value?"bg:sky-60":"opacity:.5 bg:gray-20"],"rel inline-flex p:0 h:24 w:44 flex-shrink:0 cursor:pointer rounded b:2 b:transparent transition-property:color,background-color,border-color,text-decoration-color,fill,stroke transition-duration:200 transition-timing-function:cubic-bezier(0.4,0,0.2,1) box-shadow:rgb(255,255,255)|0|0|0|2,rgb(14,165,233)|0|0|0|4,rgba(0,0,0,0)|0|0|0|0:focus outline:2|solid|transparent:focus"])},{default:N(()=>[e("span",{class:d([[r.value?"translateX(20)":"translateX(0)"],"pointer-events:none rel inline-block font:12 h:20 w:20 rounded bg:white transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter transition-duration:200 transition-timing-function:cubic-bezier(0.4,0,0.2,1) box-shadow:rgb(255,255,255)|0|0|0|0,rgba(59,130,246,0.5)|0|0|0|0,rgba(0,0,0,0.1)|0|1|3|0,rgba(0,0,0,0.1)|0|1|2|-1"])},[e("span",{"aria-hidden":"true",class:d([[r.value?"opacity:0 transition-timing-function:ease-out transition-duration:100":"opacity:1 transition-timing-function:ease-in transition-duration:200"],"abs inset:0 flex h:full w:full align-items:center justify-content:center tw-transition-opacity"])},[y(u,{icon:["fas","xmark"],class:"fg:gray-60"})],2),e("span",{"aria-hidden":"true",class:d([[r.value?"opacity:1 transition-timing-function:ease-in transition-duration:200":"opacity:0 transition-timing-function:ease-out transition-duration:100"],"abs inset:0 flex h:full w:full align-items:center justify-content:center tw-transition-opacity"])},[y(u,{icon:["fas","check"],class:"fg:sky-60"})],2)],2)]),_:1},8,["modelValue","class"]),y(s(oe),{as:"span",class:d([[r.value?"fg:black":"fg:gray-60"],"ml:8 font:medium tw-cursor-pointer"])},{default:N(()=>[w(i(r.value?"enabled":"disabled"),1)]),_:1},8,["class"])]),_:1})])])])]),e("div",Ne,[e("button",{type:"submit",name:"save",id:"save",disabled:s(f).isBusy,class:"button button-primary button-large",value:"save"},"Save",8,Fe),e("a",{class:d([{"cursor:wait":s(f).isBusy},"ml:12 fg:red-40 text:underline cursor:pointer fg:red-30:hover"]),onClick:K},i(T.value?"Deleting...":"Delete"),3)])])],32)],64)}}};export{Ye as default};
